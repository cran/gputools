OBJS = rinterface.o mi.o sort.o granger.o qrdecomp.o correlation.o hcluster.o distance.o matmult.o lsfit.o kendall.o cuseful.o

NVCC = @NVCC@
CUDA_HOME = @CUDA_HOME@
CUDA_INCLUDE = $(CUDA_HOME)/include
CUDA_LIB = @CUDA_LIB@

R_HOME = @R_HOME@
R_INCLUDE = @R_INCLUDE@
R_LIB = @R_LIB@

CC = @CC@
CFLAGS = @CFLAGS@
CPPFLAGS = @CPPFLAGS@
CPICFLAGS = @CPICFLAGS@

RPATH = @RPATH@
LDFLAGS = @LDFLAGS@

#compiler/preprocessor options
INCLUDES = -I. -I"$(CUDA_INCLUDE)" -I"$(R_INCLUDE)"
LIBS = -L"$(CUDA_LIB)" -lcublas $(R_LIB)

TARGETS = gputools.so

all: $(TARGETS) 

$(TARGETS): $(OBJS)
	$(NVCC) -shared $(RPATH) $(LDFLAGS) $(LIBS) $(OBJS) -o $@

$(OBJS): %.o: %.cu
	$(NVCC) -c -Xcompiler "$(CPICFLAGS) $(CPPFLAGS) $(CFLAGS)" $(INCLUDES) $^ -o $@

clean:
	rm -rf *o

.PHONY: all clean
