GCCEXT := c
NVEXT := cu

GCCOBJS := nocuda.o
NVOBJS := rinterface.o mi.o classification.o sort.o granger.o lr.o qrdecomp.o correlation.o hcluster.o distance.o matmult.o cuseful.o

GCCPARAMS := -fPIC
NVPARAMS= -code compute_13 -arch compute_13 -Xcompiler "-fPIC" -Xlinker "-fPIC" -I@CUDA_HOME@/include -L@CUDA_HOME@/lib -lcublas -lcuda

TARGETS=gputools.so

ifeq (@HAS_CUDA@,TRUE)
  CC=@CUDA_HOME@/bin/nvcc
  EXT=$(NVEXT)
  PARAMS=$(NVPARAMS)
  OBJS=$(NVOBJS)
else
  EXT=$(GCCEXT)
  PARAMS=$(GCCPARAMS)
  OBJS=$(GCCOBJS)
endif

all: $(TARGETS) 

$(TARGETS): $(OBJS)
	$(CC) -shared $(PARAMS) $(OBJS) -o $@

$(OBJS): %.o: %.$(EXT)
	$(CC) -c $(PARAMS) $^ -o $@

clean:
	rm -rf *o

.PHONY: all clean
